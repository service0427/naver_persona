# 네이버 페이지별 스크롤 동작 분석

## 개요

CDP `Input.dispatchTouchEvent`를 사용한 터치 스크롤 테스트 결과,
네이버 페이지별로 관성(momentum) 스크롤 동작이 다르게 작동함을 확인.

## 페이지별 동작

### m.naver.com (메인 페이지)

```
관성 스크롤: ❌ 없음
터치 거리 ≈ 실제 이동 거리 (1:1 비율)

예시:
- 터치 200px → 실제 186px 이동
- 터치 150px → 실제 144px 이동
```

**원인 추정**:
- 커스텀 스크롤 핸들러 사용
- 터치 이벤트 가로채기 후 자체 처리
- 무한스크롤 피드 최적화

### m.search.naver.com (검색 결과)

```
관성 스크롤: ✅ 작동!
터치 거리 × 10~12 = 실제 이동 거리

예시:
- 터치 210px → 실제 2302px 이동 (11x)
- 터치 125px → 실제 1460px 이동 (11.7x)
- 터치 205px → 실제 2484px 이동 (12x)
```

**관성 비율**: ~91% (실제 S23+ 측정값 89-99%와 일치!)

## 최적 스크롤 설정

### 메인 페이지 (m.naver.com)

```javascript
// 관성 없으므로 터치 거리 = 목표 거리
await realTouchScroll(page, cdp, 300, {  // 300px 이동
  duration: 100,
  flick: true,
  wobble: true  // X축 5~15px
});
```

### 검색 결과 (m.search.naver.com)

```javascript
// 관성 있으므로 짧은 터치로 큰 이동
await realTouchScroll(page, cdp, 150, {  // ~1500px 이동
  duration: 100,
  flick: true,
  wobble: true
});
```

## X축 흔들림 (Wobble)

가로 스크롤 영역(캐러셀)에 갇히지 않도록 X축 흔들림을 최소화:

| 설정 | 이전 | 수정 후 |
|------|------|---------|
| wobbleRange | 30~50px | 5~15px |
| randomNoise | ±5px | ±1.5px |

## 스크롤 간격

연속 스크롤 시 네이버의 throttling 감지를 피하기 위해:

- 스크롤 후 대기: 800~1500ms
- 스크롤 실패 시: 1500~2000ms 추가 대기
- 콘텐츠 읽기 시뮬레이션: 500~2000ms

## 양방향 스크롤

실제 사용자 패턴 반영:
- 아래로 스크롤 후 가끔 위로 복귀 (15~25% 확률)
- 위로 스크롤 거리: 50~130px (살짝만)

## 봇 탐지 회피 포인트

1. **일정하지 않은 속도**: 터치 시간 80~130ms 랜덤
2. **가변적인 거리**: 터치 거리 100~220px 랜덤
3. **자연스러운 멈춤**: 콘텐츠 읽는 시간 시뮬레이션
4. **양방향 이동**: 가끔 위로 복귀
5. **X축 안정성**: 가로 스크롤로 인식되지 않도록 최소 흔들림

## scrolllog/v2 분석 (봇 탐지 핵심)

검색 결과 페이지에서 네이버는 `l.search.naver.com/n/scrolllog/v2`로 상세한 스크롤 데이터를 수집.

### 엔드포인트
```
https://l.search.naver.com/n/scrolllog/v2?slogs=[JSON]
```

### slogs 구조

```javascript
{
  "t": "scroll",                           // 이벤트 타입: first, change, expand, scroll
  "pt": "1767019499530:1767019499848",     // 시작:종료 타임스탬프
  "al": "shp_fnd:1465:2144:1406:738",      // 영역 로그: 코드:Y:높이:노출시작:노출시간
  "cl": "shp_fnd:상품ID:Y:높이:노출시작:노출시간:X:너비:...",  // 클릭/노출 로그
  "tsi": "12706:139:993"                   // 전체높이:현재Y:뷰포트하단
}
```

### 이벤트 타입
| 타입 | 발생 시점 |
|------|-----------|
| `first` | 페이지 최초 로드 |
| `change` | DOM 변경 감지 |
| `expand` | 콘텐츠 확장 (더보기 등) |
| `scroll` | **스크롤 발생** (CDP 터치 포함!) |

### 상품 노출 추적 (`cl` 필드) - 봇 탐지 핵심!

```
shp_fnd:00000009_00140a135bbb:2824:169:47:122:0:352:0:352
        └─상품ID─────────────┘ └Y─┘└높이┘└시작┘└노출시간┘
```

네이버는 각 상품이 **화면에 몇 ms 노출되었는지** 추적:
- **봇**: 모든 상품 노출 시간이 균일하거나 0ms
- **사람**: 관심 상품에서 멈추므로 노출 시간이 다양함

### CDP 스크롤 검증 결과 (2024-12-29)

✅ **CDP `Input.dispatchTouchEvent` 스크롤이 scrolllog/v2에 정상 기록됨**

```
테스트: 5회 CDP 터치 스크롤
캡처: 5개 scrolllog 요청
결과: t="scroll" 이벤트로 정상 기록
```

## 결론

- **메인 페이지**: 관성 없음 → 여러 번 터치 필요
- **검색 결과**: 관성 있음 → 적은 터치로 큰 이동 가능
- **모든 페이지**: X축 흔들림 최소화 필수 (가로 스크롤 방지)
- **검색 결과**: scrolllog/v2로 상품 노출 시간 추적됨 → 자연스러운 읽기 시간 필요
