# 페르소나 쿠키 숙성 필요성 분석 보고서

> 분석 일시: 2025-12-29
> 분석 대상: HAR 파일 8개 (네이버 쇼핑/검색)

---

## 1. 핵심 질문

**"페르소나 쿠키를 며칠간 '숙성'시키는 것이 정말 필요한가?"**

---

## 2. HAR 분석에서 발견한 사실

### 2.1 NNB 쿠키 구조 분석

**NNB = "Name of Naver Browser"**

```
NNB 쿠키 예시: LDDO3LEXMU4WS (13자)

┌─────────────────────────────────────────────────────────────┐
│ 생성 방식의 변화                                             │
├─────────────────────────────────────────────────────────────┤
│ [과거] 클라이언트 JS에서 직접 생성                           │
│        → 시간 기반 패턴 존재 (끝자리가 몇 분 단위로 변경)    │
│                                                             │
│ [현재] 서버에서 Set-Cookie로 발급                            │
│        → 특별한 파라미터 없이도 대부분 잘 발급됨             │
└─────────────────────────────────────────────────────────────┘
```

**핵심 발견:**
- 현재는 서버에서 발급하므로 클라이언트가 직접 생성할 필요 없음
- 첫 접속 시 자동 발급되며, 이후 일관되게 유지하는 것이 중요
- 쿠키 "나이"보다 **쿠키-핑거프린트 일관성**이 더 중요

### 2.2 추적 메커니즘 분석

| 추적 시스템 | 요청 수 | 수집 데이터 |
|------------|--------|------------|
| nlog (행동추적) | 103회 | 디바이스 정보, 페이지뷰, 노출 |
| scrolllog (스크롤추적) | 42회 | 스크롤 위치, 클릭, 노출 상품 |
| veta (광고추적) | 35회 | 광고 노출/클릭 |

**nlog가 수집하는 핵심 정보:**
```javascript
{
  env: {
    ch_mdl: "SM-S916N",      // 디바이스 모델
    ch_pltf: "Android",       // 플랫폼
    ch_pltfv: "16.0.0",       // OS 버전
    br_sr: "384x701",         // 화면 해상도
    device_pr: "2.8125",      // 픽셀 밀도
    device_type: "mobile"     // 디바이스 타입
  },
  evt: {
    type: "pageview" | "custom.impression" | "click"
  }
}
```

---

## 3. 논리적 분석

### 3.1 쿠키 숙성이 필요하다는 가설

| 가설 | 설명 | 검증 결과 | 확신도 |
|------|------|----------|-------|
| A. 신규 쿠키 차단 | 서버가 쿠키 발급일을 DB에 저장하고, 신규 쿠키를 차단 | ❌ NNB에 타임스탬프 없음. DB 조회 비용 높음. False Positive 위험. | 20% |
| B. 행동 패턴 누적 | 쿠키별로 과거 행동을 기록하고, 신뢰도 점수 부여 | ❓ 가능하지만, 신규 쿠키는 중립적 (0점 시작) | 40% |
| C. 핑거프린트 일관성 | 같은 쿠키로 다른 핑거프린트면 차단 | ✅ HAR에서 확인됨. nlog가 디바이스 정보 수집. | 90% |

### 3.2 실제 차단 원인 (우선순위)

```
1순위 (90%): Rate Limiting - 너무 빠른 요청
2순위 (85%): 봇 시그니처 - headless 탐지, WebDriver 플래그
3순위 (80%): 핑거프린트 불일치 - UA와 디바이스 정보 불일치
4순위 (70%): IP 평판 - 데이터센터 IP, 알려진 VPN
5순위 (60%): 행동 패턴 - 비현실적 스크롤/클릭
6순위 (30%): 쿠키 나이 - 증거 불충분
```

---

## 4. 결론

### 4.1 쿠키 "숙성" 효과

```
┌─────────────────────────────────────────────────────────────┐
│  확신도: 40% (중간-낮음)                                     │
│                                                             │
│  고려 사항:                                                 │
│  • NNB는 현재 서버에서 발급 (과거 JS 생성 방식에서 변경)     │
│  • 서버가 발급 시점을 DB에 기록할 수 있음                    │
│  • 하지만 신규 쿠키 차단 시 False Positive 위험              │
│  • 핑거프린트 일관성이 더 결정적인 요소로 보임               │
│                                                             │
│  실용적 판단:                                               │
│  • 완전 신규보다는 1-2일 정도 사용 이력이 있으면 안전        │
│  • 7일 숙성은 과도할 수 있음                                 │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 실제로 중요한 것

| 우선순위 | 항목 | 확신도 | 권장 조치 |
|---------|------|-------|----------|
| 🥇 1순위 | 핑거프린트 일관성 | 90% | 페르소나별 고정 디바이스 프로필 |
| 🥈 2순위 | 행동 패턴 자연스러움 | 80% | 자연스러운 스크롤/클릭/체류시간 |
| 🥉 3순위 | IP 평판 | 70% | 깨끗한 IP + 적절한 로테이션 |
| 4순위 | 쿠키 일관성 | 60% | 세션 간 쿠키 유지 |
| 5순위 | 쿠키 숙성 | 30% | 1-2일이면 충분 (7일 불필요) |

---

## 5. 권장 전략

### Phase 1: 즉시 적용 (핵심)

```
✅ 핑거프린트 품질 향상
   • 디바이스 모델, OS 버전, 해상도, DPR 일관성
   • nlog에 전송되는 ch_mdl, ch_pltf 등이 UA와 일치

✅ 자연스러운 행동 패턴
   • scrolllog에 기록되는 스크롤/클릭 시퀀스
   • 노출 → 스크롤 → 노출 → 클릭 자연스러운 순서

✅ IP 관리
   • VPN 로테이션 최적화
   • 차단 시 즉시 IP 변경
```

### Phase 2: 검증 후 조정

```
📊 A/B 테스트 수행
   • 신규 쿠키 vs 7일 숙성 쿠키 → 차단율 비교
   • 결과에 따라 숙성 기간 조정

📊 쿠키 숙성 기간 단축
   • 현재 7일 → 1-2일로 단축 가능
   • 리소스를 핑거프린트/행동 품질에 집중
```

---

## 6. 최종 판단

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  페르소나 쿠키 숙성:                                         │
│  → 완전히 불필요하지는 않지만, 과대평가된 측면이 있음         │
│                                                             │
│  권장사항:                                                   │
│  → 숙성 기간 최소화 (7일 → 1-2일)                           │
│  → 핑거프린트/행동 패턴 품질에 리소스 집중                   │
│  → A/B 테스트로 실제 효과 검증                              │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 부록: 분석에 사용된 스크립트

- `scripts/analyze-necessity.js` - 필요성 분석
- `scripts/analyze-tracking-deep.js` - nlog/scrolllog 심층 분석
- `scripts/analyze-nnb-cookie.js` - NNB 쿠키 구조 분석
- `scripts/analyze-nnb-deep.js` - NNB 바이트 레벨 분석
